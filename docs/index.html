<!doctype html>
<notebook theme="midnight">
  <title>Mozambique LNG logistics</title>
  <script id="header" type="text/markdown">
    # Mozambique LNG logistics

    *10 September 2025*
  </script>
  <script id="banner" type="text/html">
    <figure style="max-width: 100%">
      <img src="assets/agungi-airstrip-planet-skysat-2025-07-25.jpg" />
      <figcaption>A passenger jet on the apron at Afungi airstrip, 25 July 2025. Satellite image: Planet SkySat.</figcaption>
    </figure>
  </script>
  <script id="intro" type="text/markdown">
    ## Key findings

    - The Mozambique LNG project has been suspended under *force majeure* since 2021, but recent activity at the [project site](https://www.openstreetmap.org/#map=13/-10.81670/40.53474) in Afungi, Cabo Delgado suggests that full-scale work is about to restart.
  
    - A small passenger jet with a capacity of around 50 people has made dozens of trips between Maputo, Pemba and Afungi since 1 May, and is currently leased to an aviation company specialising in oil and gas projects.

    - Other remote sensing data — including satellite imagery of the project site and ADS-B data from ships — shows significant activity in and around Palma Bay.
  </script>
   <script id="ads-b" type="text/markdown">
     ## Passenger flights

      <figure style="max-width:100%">
        <div id="flight-map" style="height: 500px; width: 100%; margin-bottom: 10px;"></div>
        <figcaption>Flight tracks for V5-WEN (Embraer ERJ 145) from 1 May to 29 August 2025, showing flights between Maputo, Pemba, and the Afungi airstrip. Source: <a href="https://globe.adsbexchange.com/?icao=20104f">ADS-B Exchange</a>.</figcaption>
      </figure>

    On 1 May 2025, an Embraer ERJ 145 passenger jet with the registration V5-WEN flew from the Mozambican capital, Maputo, to the port of Pemba. Less than an hour later, the jet — which carries [about 50 people](https://en.wikipedia.org/wiki/Embraer_ERJ_family) at a time — took off and headed north towards the Afungi airstrip.

    While the [available location data](https://globe.adsbexchange.com/?icao=20104f&lat=-11.533&lon=40.397&zoom=9.8&showTrace=2025-05-01&leg=2&trackLabels) doesn't show the plane landing, its course, altitude and subsequent movements make clear that it landed at Afungi. The lack of data at the project site may be due to limited coverage of remote areas by the [ADS-B Exchange](https://globe.adsbexchange.com/) project, or to deliberate disabling of the plane's ADS-B transponder.
    
    Since 1 May, the same aircraft appears to have made dozens of flights between Maputo, Pemba and Afungi, most recently on [29 August](https://globe.adsbexchange.com/?icao=20104f&lat=-11.945&lon=40.210&zoom=8.6&showTrace=2025-08-29&leg=2&trackLabels). V5-WEN is owned by Fly Namibia and ordinarily operated by Westair Aviation, but was [leased to a different company](https://www.planespotters.net/airframe/embraer-erj-145-v5-wen-everett-aviation/3xwkl8), Everett Aviation, in  April 2025, suggesting that it may have been chartered specifically for Mozambique LNG project logistics.

    According to Everett's [website](https://www.everettaviation.com/), the company provides "safe and solution oriented fixed & rotary wing aviation services, serving international clients from the energy sector and other government & commercial organizations with specialist aviation needs."

    In addition to the trips by V5-WEN, another jet is visible in high-resolution satellite imagery at Afungi airstrip on 25 July 2025 at 11:25 UTC (see image above). While its size and appearance roughly match that of the V5-WEN, its presence at this date and time does not match the flight records.
   </script>

   <script id="mapbox-css" type="text/html">
     <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
   </script>



   <script id="mapbox-js" type="module">
     // Load Mapbox GL JS
     const script = document.createElement('script');
     script.src = 'https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js';
     script.onload = () => {
       initializeFlightMap();
     };
     document.head.appendChild(script);

      function initializeFlightMap() {
        // Set Mapbox access token
        window.mapboxgl.accessToken = 'pk.eyJ1IjoiZGF0YS1kZXNrIiwiYSI6ImNsYmNlcjl4bjBjd3UzcG55dHluaHYzbmQifQ.2wVVsUzF2BHBJ9ywCxCqWw';

         // Initialize map with dark theme and terrain, starting at ground level then rising up
         const map = new window.mapboxgl.Map({
           container: 'flight-map',
           style: 'mapbox://styles/mapbox/dark-v11',
           center: [40.4, -11.6], // Center between Pemba and Afungi
           zoom: 8.2,  // Adjusted zoom level
           pitch: 0, // Start at ground level
           bearing: 225, // Looking from northeast to southwest
           attributionControl: false // Remove Mapbox attribution and "improve this map" labels
         });

       // Add terrain source for 3D elevation
       map.on('load', () => {
         map.addSource('terrain', {
           type: 'raster-dem',
           url: 'mapbox://mapbox.terrain-rgb'
         });

         // Add terrain layer
         map.addLayer({
           id: 'terrain',
           type: 'hillshade',
           source: 'terrain',
           layout: { visibility: 'visible' },
           paint: { 'hillshade-shadow-color': '#000000' }
         });

          // Enable terrain
          map.setTerrain({
            source: 'terrain',
            exaggeration: 1.5
          });

          // Transition pitch from 0 to 70 degrees (rising up)
          map.easeTo({
            pitch: 70,
            duration: 2000
          });
        });

       // Load all available flight track data files (44 total flights)
       const flightFiles = [
         '2025-05-01', '2025-05-07', '2025-05-09', '2025-05-13', '2025-05-15', '2025-05-21', '2025-05-23',
         '2025-05-27', '2025-05-29', '2025-05-31', '2025-06-01', '2025-06-03', '2025-06-05', '2025-06-09',
         '2025-06-11', '2025-06-13', '2025-06-17', '2025-06-19', '2025-06-23', '2025-06-25', '2025-06-27',
         '2025-07-01', '2025-07-03', '2025-07-07', '2025-07-09', '2025-07-11', '2025-07-15', '2025-07-17',
         '2025-07-21', '2025-07-23', '2025-07-25', '2025-07-31', '2025-08-01', '2025-08-05', '2025-08-07',
         '2025-08-11', '2025-08-13', '2025-08-15', '2025-08-19', '2025-08-20', '2025-08-21', '2025-08-25',
         '2025-08-27', '2025-08-29'
       ];

       let allCoordinates = [];
       let loadedTracks = 0;
       const totalTracks = flightFiles.length;

       // Function to load a single flight track
       function loadFlightTrack(date) {
          // Use absolute path from repo root for GitHub Pages
         const basePath = window.location.pathname.includes('afungi-logistics') ? '/afungi-logistics' : '';
         return fetch(basePath + '/data/flight-track-' + date + '.json')
          .then(response => {
            if (!response.ok) {
              console.log('No data for ' + date);
              return null;
            }
           return response.json();
         })
         .then(data => {
           if (data && data.trace && data.trace.length > 0) {
             const coordinates = data.trace.map(point => [point[2], point[1]]);
             allCoordinates.push(...coordinates);

             // Create altitude-based gradient coloring
             const sourceId = `flight-path-${date}`;
             const layerId = `flight-path-${date}`;

             if (!map.getSource(sourceId)) {
               // Find altitude range for this flight first (skip None/null values)
               let minAlt = Infinity;
               let maxAlt = -Infinity;

               data.trace.forEach(point => {
                 const alt = point[3]; // altitude is at index 3
                 if (alt !== null && alt !== undefined && typeof alt === 'number') {
                   if (alt < minAlt) minAlt = alt;
                   if (alt > maxAlt) maxAlt = alt;
                 }
               });

               console.log(`Flight altitude range: ${minAlt} - ${maxAlt} ft`);

               // Create GeoJSON with altitude data for gradient coloring
               const features = [];

               // Create 3D extruded polygons from ALL line segments (use every data point)
               for (let i = 0; i < data.trace.length - 1; i++) {
                 const startPoint = data.trace[i];
                 const endPoint = data.trace[i + 1];

                 // Extract coordinates: [timestamp, lat, lng, alt, ...]
                 const startCoord = [startPoint[2], startPoint[1]]; // [lng, lat]
                 const endCoord = [endPoint[2], endPoint[1]];     // [lng, lat]
                 const startAlt = startPoint[3];
                 const endAlt = endPoint[3];

                 // Skip segments with invalid altitude data
                 if (startAlt === null || startAlt === undefined ||
                     endAlt === null || endAlt === undefined ||
                     typeof startAlt !== 'number' || typeof endAlt !== 'number') {
                   continue;
                 }

                 const avgAlt = (startAlt + endAlt) / 2;

                 // Create color based on altitude (low = blue, high = red)
                 const altRatio = (avgAlt - minAlt) / (maxAlt - minAlt || 1);
                 let color;
                 if (altRatio < 0.33) {
                   const ratio = altRatio / 0.33;
                   color = `rgb(${Math.round(255)}, ${Math.round(0 + ratio * 255)}, ${Math.round(0)})`;
                 } else if (altRatio < 0.66) {
                   const ratio = (altRatio - 0.33) / 0.33;
                   color = `rgb(${Math.round(255 - ratio * 255)}, ${Math.round(255)}, ${Math.round(0 + ratio * 255)})`;
                 } else {
                   const ratio = (altRatio - 0.66) / 0.34;
                   color = `rgb(${Math.round(0)}, ${Math.round(255 - ratio * 155)}, ${Math.round(255)})`;
                 }

                 // Create a thin but tall polygon along the flight path for 3D extrusion
                 const width = 0.0008; // Thin but visible width

                 // Calculate perpendicular vector for polygon width
                 const dx = endCoord[0] - startCoord[0];
                 const dy = endCoord[1] - startCoord[1];
                 const length = Math.sqrt(dx * dx + dy * dy);

                 if (length > 0) {
                   const nx = -dy / length * width;
                   const ny = dx / length * width;

                   features.push({
                     type: 'Feature',
                     properties: {
                       altitude: avgAlt,
                       color: color,
                       extrusion_height: Math.max(150, avgAlt * 0.3), // Reasonable altitude scaling
                     extrusion_base: Math.max(0, (avgAlt * 0.3) - 180) // Slightly less deep profile (180-unit thickness)
                     },
                     geometry: {
                       type: 'Polygon',
                       coordinates: [[
                         [startCoord[0] - nx, startCoord[1] - ny],
                         [startCoord[0] + nx, startCoord[1] + ny],
                         [endCoord[0] + nx, endCoord[1] + ny],
                         [endCoord[0] - nx, endCoord[1] - ny],
                         [startCoord[0] - nx, startCoord[1] - ny]
                       ]]
                     }
                   });
                 }
               }

               map.addSource(sourceId, {
                 type: 'geojson',
                 data: {
                   type: 'FeatureCollection',
                   features: features
                 }
               });

               // Add 3D extruded fill layer for true altitude visualization
               map.addLayer({
                 id: layerId,
                 type: 'fill-extrusion',
                 source: sourceId,
                 paint: {
                   'fill-extrusion-color': ['get', 'color'],
                   'fill-extrusion-height': ['get', 'extrusion_height'],
                   'fill-extrusion-base': ['get', 'extrusion_base'],
                   'fill-extrusion-opacity': 0.9
                 }
               });



               console.log('Added altitude-colored flight track for ' + date + ' (alt range: ' + minAlt + ' - ' + maxAlt + ' ft)');

                console.log('Added flight track for ' + date + ' with ' + coordinates.length + ' points');
             }
           }
           return data;
         })
          .catch(error => {
            console.log('Error loading ' + date + ':', error);
            return null;
          });
       }

       // Note: finalizeMap is now called after all tracks are loaded via Promise.all

       // Function to finalize map setup
        function finalizeMap() {
          console.log('Finalizing map with ' + allCoordinates.length + ' total coordinate points');

         if (allCoordinates.length > 0) {
           // Fit map to show all flight paths
           const bounds = new window.mapboxgl.LngLatBounds();
           allCoordinates.forEach(coord => {
             if (coord && coord.length === 2 && !isNaN(coord[0]) && !isNaN(coord[1])) {
               bounds.extend(coord);
             }
           });

             // Keep the current view showing both Pemba and Afungi
             // The 3D extruded paths will be visible in the current view
             console.log('Keeping view showing both Pemba and Afungi');
         } else {
           console.log('No flight coordinates found, keeping default map view');
         }
        }

       // Wait for map to load, then load all flight tracks
       map.on('load', () => {
         console.log('Map loaded, starting flight track loading...');

         // Load all flight tracks in parallel
         const loadPromises = flightFiles.map(date => loadFlightTrack(date));

          Promise.all(loadPromises).then(results => {
            const successfulLoads = results.filter(r => r !== null).length;
            console.log('Loaded ' + successfulLoads + ' flight tracks out of ' + flightFiles.length + ' total files');

           if (successfulLoads === 0) {
             console.log('No flight data available. This might be because:');
             console.log('1. The data is from the future (2025) and not yet available');
             console.log('2. The aircraft did not fly on the specified dates');
             console.log('3. API access restrictions or data format changes');
             console.log('4. The flight data might be available through different sources');

              // Show a helpful message on the map
              map.on('load', () => {
                const mapContainer = document.getElementById('flight-map');
                if (mapContainer) {
                  mapContainer.innerHTML = '<div style="text-align: center; padding: 50px; color: #666; background: #1a1a1a; height: 100%; display: flex; flex-direction: column; justify-content: center;"><h3 style="color: #fff; margin-bottom: 20px;">Flight Track Data Unavailable</h3><p style="margin-bottom: 15px;">No flight data could be loaded for the specified dates.</p><p style="font-size: 14px; opacity: 0.8;">This may be because the data is from 2025 and not yet available, or the aircraft didn\'t fly on those dates.</p><p style="font-size: 14px; opacity: 0.8;">The visualization will update automatically when data becomes available.</p></div>';
                }
             });
           } else {
             finalizeMap();
           }
         });
       });
      }
    </script>
    <script id="flight-summary-data" type="module">
    // Use absolute path from repo root for GitHub Pages
    const basePath = window.location.pathname.includes('afungi-logistics') ? '/afungi-logistics' : '';
    const flightSummary = await FileAttachment(basePath + "/data/flight-summary.csv").csv({typed: true});
    
    // Format time from ISO timestamp
    const formatTime = (timestamp) => {
      const d = new Date(timestamp);
      return d.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false});
    };
    
    /*display(Inputs.table(flightSummary.map(f => ({
      Date: f.flight_date,
      "Flight": f.flight_num,
      "Takeoff Time": formatTime(f.takeoff_timestamp),
      "Landing Time": formatTime(f.landing_timestamp),
      Route: `${f.takeoff_location} → ${f.landing_location}`,
      "Duration (min)": f.flight_duration_minutes
    }))));*/
    
    // Make data available globally for map visualization
    window.flightSummaryData = flightSummary;
  </script> 
  <script id="satellite-imagery" type="text/markdown">
    ## Construction work

    <figure style="max-width:100%">
      <img src="assets/afungi-construction-2025-04-27-2025-08-24.png" />
      <figcaption>A comparison of Planet SkySat satellite imagery from 27 April 2025 and 24 August 2025, showing significant construction work at the Mozambique LNG project site.
    </figure>

    Major construction work now appears to be underway at the project site. Comparing recent satellite imagery to comparable imagery from April reveals a [specific area](https://earth.google.com/web/@-10.81175746,40.54830903,8.54686032a,1836.63914305d,30.00017325y,0.00032876h,0t,0r/data=CgRCAggBOgMKATBCAggASg0I____________ARAA) that has seen the most significant work, including construction of buildings.
  </script>
  <script id="ais" type="text/markdown">
    ## Vessel activity

    <figure style="max-width:100%">
      <img src="assets/gfw-map.png" />
      <figcaption>Uptick in vessel activity at the Mozambique LNG project site in August 2025. Source: <a href="https://globalfishingwatch.org/map/report/palma_bay_vessel_activity-user-public?longitude=40.5784225&latitude=-10.75874886&zoom=11.86219571&dvIn[0][id]=basemap&dvIn[0][cfg][basemap]=satellite&dvIn[1][id]=presence&dvIn[1][cfg][vis]=true&dvIn[1][cfg][clr]=%23FFEA00&dvIn[1][cfg][colorRamp]=yellow&dvIn[2][id]=vms&dvIn[2][cfg][vis]=false&dvIn[3][id]=ais&dvIn[3][cfg][vis]=false&dvIn[4][id]=user-polygons-1756466528933-1756466528933&dvIn[4][cfg][clr]=%23F95E5E&dvIn[4][dvId]=default-context-layer&dvIn[4][dsC][0][dsId]=public-palma-bay-1747920527235&dvIn[4][dsC][0][ept]=context-tiles&lTD=&fTD=&bDV&start=2025-07-01T00%3A00%3A00.000Z&end=2025-08-26T00%3A00%3A00.000Z&vDi=public-global-vessel-identity%3Av3.0&vIs=registryInfo&vAm=type&vS=activity&vA=eez&vR=encounters&includeRelatedIdentities=true&sbO=true&rAG=evolution"></a></figcaption>
   </figure>

    AIS data aggregated by the [Global Fishing Watch](https://globalfishingwatch.org/map/report/palma_bay_vessel_activity-user-public?longitude=40.5784225&latitude=-10.75874886&zoom=11.86219571&dvIn[0][id]=basemap&dvIn[0][cfg][basemap]=satellite&dvIn[1][id]=presence&dvIn[1][cfg][vis]=true&dvIn[1][cfg][clr]=%23FFEA00&dvIn[1][cfg][colorRamp]=yellow&dvIn[2][id]=vms&dvIn[2][cfg][vis]=false&dvIn[3][id]=ais&dvIn[3][cfg][vis]=false&dvIn[4][id]=user-polygons-1756466528933-1756466528933&dvIn[4][cfg][clr]=%23F95E5E&dvIn[4][dvId]=default-context-layer&dvIn[4][dsC][0][dsId]=public-palma-bay-1747920527235&dvIn[4][dsC][0][ept]=context-tiles&lTD=&fTD=&bDV&start=2025-07-01T00%3A00%3A00.000Z&end=2025-08-26T00%3A00%3A00.000Z&vDi=public-global-vessel-identity%3Av3.0&vIs=registryInfo&vAm=type&vS=activity&vA=eez&vR=encounters&includeRelatedIdentities=true&sbO=true&rAG=evolution) project shows an increase in vessel activity in Palma Bay from mid-August. Vessels involved — visible via the GFW web interface — include the Gombessa (IMO 8733897, a passenger vessel) and the Topaz Tobol (IMO 9812224, a heavy load carrier).  
  </script>
  <script id="database-setup" type="module">
    // Should be able to remove this in future versions of Notebook Kit
    const db = DuckDBClient.of();
  </script>
</notebook>
